{"id":"heartbeads-cli-58a","title":"Epic: hb CLI — ATProto-authenticated wrapper around bd for AI agents","description":"Build 'hb' — a Go CLI that wraps the 'bd' (beads) binary. AI agents use 'hb' instead of 'bd' directly. Key features: (1) ATProto login required before any bd command works, (2) all bd output text-rewritten so 'bd' becomes 'hb', (3) assignee auto-injected from logged-in ATProto handle on claim/create/close. Architecture: single Go binary using urfave/cli/v3, stores auth session via XDG (pattern from audiogoat), shells out to bd with BD_NAME=hb and post-processes stdout/stderr to replace remaining 'bd' references.","status":"in_progress","priority":1,"issue_type":"epic","assignee":"david.gainforest.id","owner":"david@gainforest.net","created_at":"2026-02-13T12:56:35.198694+13:00","created_by":"daviddao","updated_at":"2026-02-13T13:01:36.528069+13:00"}
{"id":"heartbeads-cli-58a.1","title":"Scaffold Go module and CLI skeleton with urfave/cli/v3","description":"## Files\n- go.mod (create)\n- go.sum (create)\n- main.go (create)\n- main_test.go (create)\n- Makefile (create)\n- .gitignore (create)\n- .golangci.yaml (create)\n\n## What to do\nCreate the Go module github.com/gainforest/heartbeads-cli with:\n\n1. **go.mod**: module github.com/gainforest/heartbeads-cli, go 1.25, require github.com/urfave/cli/v3 v3.4.1\n2. **main.go**:\n   - Binary name: hb\n   - Root command: Name=hb, Usage=\"Authenticated beads CLI for AI agents\"\n   - Version variable settable via ldflags\n   - Pattern: func main() calls run(os.Args), func run(args []string) error calls runWithOutput(args, os.Stdout), func runWithOutput(args []string, w io.Writer) error builds app and runs it. This testable pattern is from audiogoat.\n   - Root command has one subcommand for now: version (prints \"hb version X.Y.Z\")\n   - No other commands yet (those come in later tasks)\n3. **main_test.go**: Table-driven test that hb --version exits 0 and contains \"hb version\", and hb without args exits 0 (shows help).\n4. **Makefile**: targets build, test, lint, fmt, clean (same pattern as audiogoat Makefile). Build output binary named 'hb'.\n5. **.gitignore**: hb binary, coverage files, .env\n6. **.golangci.yaml**: enable govet, staticcheck, unused, ineffassign, misspell, unconvert (same as audiogoat)\n\n## Test\ngo test ./... \u0026\u0026 go build -o hb . \u0026\u0026 ./hb --version | grep \"hb version\"\n\n## Don't\n- Add any auth logic yet\n- Add any bd wrapping logic yet\n- Use cobra (use urfave/cli/v3 to match audiogoat pattern)\n- Use any atproto dependencies yet","status":"in_progress","priority":1,"issue_type":"task","assignee":"david.gainforest.id","owner":"david@gainforest.net","created_at":"2026-02-13T12:57:09.154089+13:00","created_by":"daviddao","updated_at":"2026-02-13T13:01:36.791294+13:00","labels":["scope:small"],"dependencies":[{"issue_id":"heartbeads-cli-58a.1","depends_on_id":"heartbeads-cli-58a","type":"parent-child","created_at":"2026-02-13T12:57:09.155159+13:00","created_by":"daviddao"}]}
{"id":"heartbeads-cli-58a.10","title":"AGENTS.md: update to reference hb instead of bd","description":"## Files\n- AGENTS.md (modify)\n\n## What to do\nRewrite AGENTS.md so AI agents using this repo are instructed to use hb, not bd:\n\nReplace the current AGENTS.md content with:\n\n```markdown\n# Agent Instructions\n\nThis project uses **hb** (heartbeads) for issue tracking — an authenticated wrapper around beads.\n\n## Setup\n\nFirst, login with your ATProto account:\n\\`\\`\\`bash\nhb account login --username \u003cyour-handle\u003e --password \u003capp-password\u003e\n\\`\\`\\`\n\n## Quick Reference\n\n\\`\\`\\`bash\nhb ready              # Find available work\nhb show \u003cid\u003e          # View issue details\nhb update \u003cid\u003e --status in_progress  # Claim work\nhb close \u003cid\u003e         # Complete work\nhb sync               # Sync with git\n\\`\\`\\`\n\nNote: hb automatically sets --assignee to your ATProto handle on create, update, and close commands.\n\n## Session Completion\n\nWhen ending a work session, you MUST complete ALL steps below:\n\n1. Run quality gates (if code changed) - Tests, linters, builds\n2. Update issue status - Close finished work\n3. Push to remote:\n   \\`\\`\\`bash\n   git pull --rebase\n   hb sync\n   git push\n   git status  # MUST show \"up to date with origin\"\n   \\`\\`\\`\n```\n\n## Test\ngrep -q \"hb account login\" AGENTS.md \u0026\u0026 ! grep -q '`bd ' AGENTS.md\n\n## Don't\n- Reference bd anywhere in the file\n- Remove the session completion section\n- Add implementation details about hb's internals","status":"open","priority":2,"issue_type":"task","assignee":"david.gainforest.id","owner":"david@gainforest.net","created_at":"2026-02-13T12:59:22.195234+13:00","created_by":"daviddao","updated_at":"2026-02-13T12:59:22.195234+13:00","labels":["scope:trivial"],"dependencies":[{"issue_id":"heartbeads-cli-58a.10","depends_on_id":"heartbeads-cli-58a","type":"parent-child","created_at":"2026-02-13T12:59:22.195876+13:00","created_by":"daviddao"},{"issue_id":"heartbeads-cli-58a.10","depends_on_id":"heartbeads-cli-58a.1","type":"blocks","created_at":"2026-02-13T13:00:16.474254+13:00","created_by":"daviddao"}]}
{"id":"heartbeads-cli-58a.11","title":"README.md: project documentation for heartbeads-cli","description":"## Files\n- README.md (create)\n\n## What to do\nCreate README.md with:\n\n1. **Title**: heartbeads-cli (hb) — Authenticated beads CLI for AI agents\n2. **Overview**: hb wraps the bd (beads) CLI with ATProto authentication. AI agents use hb instead of bd to ensure identity-aware issue tracking. Every create/update/close automatically sets --assignee to the logged-in ATProto handle.\n3. **Install**:\n   - Prerequisites: Go 1.25+, bd (beads) CLI installed\n   - go install github.com/gainforest/heartbeads-cli@latest\n   - Or: git clone + make build\n4. **Quick Start**:\n   ```bash\n   hb account login --username alice.bsky.social --password app-password-123\n   hb init\n   hb create \"My first issue\" --type task --priority 2\n   hb ready\n   hb close \u003cid\u003e\n   ```\n5. **How it works**:\n   - hb proxies all commands to bd with BD_NAME=hb\n   - Output is rewritten: \"bd\" → \"hb\" so agents never see \"bd\"\n   - Auth session stored in XDG state dir (~/.local/state/heartbeads/)\n   - --assignee auto-injected on create, update, close, q commands\n6. **Commands**: hb account login/logout/status, plus all bd commands (hb list, hb create, etc.)\n7. **For AI Agents**: Reference AGENTS.md for agent-specific instructions\n8. **License**: MIT (or whatever the project uses — check with owner)\n\n## Test\ntest -f README.md \u0026\u0026 grep -q \"hb account login\" README.md \u0026\u0026 grep -q \"ATProto\" README.md\n\n## Don't\n- Include implementation details about internal Go functions\n- Reference \"audiogoat\" anywhere\n- Make it longer than ~100 lines","status":"open","priority":2,"issue_type":"task","assignee":"david.gainforest.id","owner":"david@gainforest.net","created_at":"2026-02-13T12:59:36.199565+13:00","created_by":"daviddao","updated_at":"2026-02-13T12:59:36.199565+13:00","labels":["scope:trivial"],"dependencies":[{"issue_id":"heartbeads-cli-58a.11","depends_on_id":"heartbeads-cli-58a","type":"parent-child","created_at":"2026-02-13T12:59:36.200402+13:00","created_by":"daviddao"},{"issue_id":"heartbeads-cli-58a.11","depends_on_id":"heartbeads-cli-58a.1","type":"blocks","created_at":"2026-02-13T13:00:16.566005+13:00","created_by":"daviddao"}]}
{"id":"heartbeads-cli-58a.12","title":"Catch-all proxy: handle unknown subcommands by forwarding to bd","description":"## Files\n- main.go (modify)\n- catchall_test.go (create)\n\n## What to do\nAdd catch-all handling so any bd command not explicitly registered in hb still works:\n\n1. Modify the root command's Action in main.go. When an unknown subcommand is invoked (e.g., \"hb some-future-bd-command\"), instead of showing \"unknown command\" error:\n   - Check if the first arg looks like a bd subcommand (not a flag, not \"account\")\n   - Call requireAuth() for the session\n   - Forward all args to runBd with assignee injection\n   - This ensures future bd commands work with hb without needing hb code changes\n\n2. Implementation approach: In buildApp(), set the root command's Action to a function that:\n   - If no args (just \"hb\"), show help\n   - If first arg starts with \"-\", show help (it's a flag)\n   - Otherwise, treat args as a bd command: auth check → runBd(ctx, os.Args[1:]) with rewriting\n   - Use cmd.Args().Slice() to get unrecognized args\n\n3. Also handle the case where \"hb --help\" and \"hb --version\" still work without auth.\n\n**catchall_test.go**:\n- TestCatchallNoAuth: invoke hb with a fake subcommand (\"hb fakecmd\") without auth, verify \"Not logged in\" error\n- TestCatchallHelp: invoke \"hb\" with no args, verify help output contains \"account\"\n\n## Test\ngo test -v -run \"TestCatchall\" ./...\n\n## Don't\n- Remove the explicit proxy commands (keep both explicit + catch-all)\n- Allow catch-all to bypass auth (all unknown commands require auth)\n- Forward \"account\" subcommand to bd (account is handled by hb directly)","status":"open","priority":2,"issue_type":"task","assignee":"david.gainforest.id","owner":"david@gainforest.net","created_at":"2026-02-13T12:59:50.817689+13:00","created_by":"daviddao","updated_at":"2026-02-13T12:59:50.817689+13:00","labels":["scope:small"],"dependencies":[{"issue_id":"heartbeads-cli-58a.12","depends_on_id":"heartbeads-cli-58a","type":"parent-child","created_at":"2026-02-13T12:59:50.818451+13:00","created_by":"daviddao"},{"issue_id":"heartbeads-cli-58a.12","depends_on_id":"heartbeads-cli-58a.8","type":"blocks","created_at":"2026-02-13T13:00:16.652888+13:00","created_by":"daviddao"}]}
{"id":"heartbeads-cli-58a.13","title":"CI: GitHub Actions workflow for test, lint, build","description":"## Files\n- .github/workflows/ci.yaml (create)\n\n## What to do\nCreate a GitHub Actions CI workflow based on audiogoat's pattern:\n\n1. **Trigger**: push to main, pull_request to main\n2. **Job: test**\n   - runs-on: ubuntu-latest\n   - steps: checkout, setup-go (1.25), install bd (go install github.com/steveyegge/beads/cmd/bd@latest), go test ./..., go test -tags integration ./...\n3. **Job: lint**\n   - runs-on: ubuntu-latest  \n   - steps: checkout, setup-go, golangci-lint-action\n4. **Job: build**\n   - runs-on: ubuntu-latest\n   - steps: checkout, setup-go, make build, verify binary exists and runs (./hb --version)\n5. **Matrix**: test on go 1.25 (only one version needed for now)\n\n## Test\ntest -f .github/workflows/ci.yaml \u0026\u0026 grep -q \"go test\" .github/workflows/ci.yaml\n\n## Don't\n- Add release/deploy workflows (not needed yet)\n- Add integration tests that require ATProto credentials\n- Use complex matrix strategies (keep it simple)","status":"open","priority":3,"issue_type":"task","assignee":"david.gainforest.id","owner":"david@gainforest.net","created_at":"2026-02-13T13:00:01.389347+13:00","created_by":"daviddao","updated_at":"2026-02-13T13:00:01.389347+13:00","labels":["scope:trivial"],"dependencies":[{"issue_id":"heartbeads-cli-58a.13","depends_on_id":"heartbeads-cli-58a","type":"parent-child","created_at":"2026-02-13T13:00:01.390159+13:00","created_by":"daviddao"},{"issue_id":"heartbeads-cli-58a.13","depends_on_id":"heartbeads-cli-58a.1","type":"blocks","created_at":"2026-02-13T13:00:16.739647+13:00","created_by":"daviddao"}]}
{"id":"heartbeads-cli-58a.2","title":"ATProto auth session: persist, load, wipe (XDG state)","description":"## Files\n- auth.go (create)\n- auth_test.go (create)\n\n## What to do\nPort the auth session persistence layer from audiogoat/auth.go, adapted for hb:\n\n1. **AuthSession struct**: DID (syntax.DID), PDS (string), Handle (string), Password (string), AccessToken (string), RefreshToken (string) — exact same as audiogoat\n2. **persistAuthSession(sess *AuthSession) error**: Save JSON to XDG state dir at \"heartbeads/auth-session.json\" with 0600 permissions\n3. **loadAuthSessionFile() (*AuthSession, error)**: Load from XDG state. Return ErrNoAuthSession (sentinel) if file missing.\n4. **wipeAuthSession() error**: Delete session file. No error if already missing.\n5. **ErrNoAuthSession**: Sentinel error var.\n\nDependencies: github.com/adrg/xdg, github.com/bluesky-social/indigo/atproto/syntax\n\n**auth_test.go**: Port TestPersistAuthSession, TestLoadAuthSessionFile (both subtests), TestWipeAuthSession (both subtests) from audiogoat/auth_test.go. Use setupTestXDG helper (t.TempDir + t.Setenv XDG_STATE_HOME + xdg.Reload). Change path from \"audiogoat/\" to \"heartbeads/\".\n\n## Test\ngo test -v -run \"TestPersist|TestLoad|TestWipe\" ./...\n\n## Don't\n- Add loadAuthClient (that comes in a later task)\n- Add authRefreshCallback yet\n- Import urfave/cli/v3 in this file","status":"open","priority":1,"issue_type":"task","assignee":"david.gainforest.id","owner":"david@gainforest.net","created_at":"2026-02-13T12:57:22.204565+13:00","created_by":"daviddao","updated_at":"2026-02-13T12:57:22.204565+13:00","labels":["scope:small"],"dependencies":[{"issue_id":"heartbeads-cli-58a.2","depends_on_id":"heartbeads-cli-58a","type":"parent-child","created_at":"2026-02-13T12:57:22.205353+13:00","created_by":"daviddao"},{"issue_id":"heartbeads-cli-58a.2","depends_on_id":"heartbeads-cli-58a.1","type":"blocks","created_at":"2026-02-13T13:00:15.432794+13:00","created_by":"daviddao"}]}
{"id":"heartbeads-cli-58a.3","title":"ATProto auth client: login, resume session, refresh callback","description":"## Files\n- auth.go (modify — add functions)\n- auth_test.go (modify — add tests)\n\n## What to do\nAdd the ATProto client authentication functions to auth.go (below the persistence layer from task .2):\n\n1. **authRefreshCallback(ctx context.Context, data atclient.PasswordSessionData)**: Updates persisted session when tokens refresh. Same as audiogoat.\n2. **configDirectory(plcHost string) identity.Directory**: Returns identity.DefaultDirectory(). Same as audiogoat.\n3. **loadAuthClient(ctx context.Context) (*atclient.APIClient, error)**: Load saved session, try ResumePasswordSession, fallback to LoginWithPassword. NOTE: Unlike audiogoat, this does NOT take a *cli.Command param — it reads plcHost from os.Getenv(\"ATP_PLC_HOST\") defaulting to \"https://plc.directory\".\n4. **getLoggedInHandle() (string, error)**: Convenience function: calls loadAuthSessionFile(), returns sess.Handle. Returns ErrNoAuthSession if not logged in. This is used by the bd wrapper to auto-inject --assignee.\n\nDependencies: github.com/bluesky-social/indigo/api/atproto, github.com/bluesky-social/indigo/atproto/atclient, github.com/bluesky-social/indigo/atproto/identity\n\n**auth_test.go additions**:\n- TestConfigDirectory: verify non-nil return (same as audiogoat)\n- TestGetLoggedInHandle: subtest \"returns handle when session exists\" (write session file, call getLoggedInHandle, check handle matches), subtest \"returns ErrNoAuthSession when no session\" (empty XDG dir)\n\n## Test\ngo test -v -run \"TestConfigDirectory|TestGetLoggedInHandle\" ./...\n\n## Don't\n- Modify the persistence functions from task .2\n- Add any CLI command definitions\n- Make loadAuthClient depend on urfave/cli Command","status":"open","priority":1,"issue_type":"task","assignee":"david.gainforest.id","owner":"david@gainforest.net","created_at":"2026-02-13T12:57:35.527974+13:00","created_by":"daviddao","updated_at":"2026-02-13T12:57:35.527974+13:00","labels":["scope:small"],"dependencies":[{"issue_id":"heartbeads-cli-58a.3","depends_on_id":"heartbeads-cli-58a","type":"parent-child","created_at":"2026-02-13T12:57:35.528598+13:00","created_by":"daviddao"},{"issue_id":"heartbeads-cli-58a.3","depends_on_id":"heartbeads-cli-58a.2","type":"blocks","created_at":"2026-02-13T13:00:15.518345+13:00","created_by":"daviddao"}]}
{"id":"heartbeads-cli-58a.4","title":"Account commands: hb account login/logout/status","description":"## Files\n- account.go (create)\n- account_test.go (create)\n- main.go (modify — add cmdAccount to root Commands list)\n\n## What to do\nCreate the account subcommand group, ported from audiogoat/account.go:\n\n1. **cmdAccount** (var *cli.Command): Name=\"account\", Usage=\"Auth session and account management\"\n2. **Subcommands**:\n   - **login**: Name=\"login\", Usage=\"Login with ATProto credentials\"\n     - Flags: --username/-u (required, env ATP_USERNAME), --password/-p (required, env ATP_PASSWORD), --pds-host (optional, env ATP_PDS_HOST)\n     - Action runAccountLogin: Same logic as audiogoat. On success prints \"Logged in as \u003chandle\u003e (\u003cdid\u003e)\" to cmd.Root().Writer\n   - **logout**: Name=\"logout\", Usage=\"Delete current session\"\n     - Action runAccountLogout: calls wipeAuthSession(), prints \"Logged out\"\n   - **status**: Name=\"status\", Usage=\"Check login status\"\n     - Action runAccountStatus: calls loadAuthClient, if ErrNoAuthSession returns error \"not logged in (run: hb account login)\". On success prints DID, Handle, PDS, active/deactivated status. NOTE: error message says \"hb\" not \"audiogoat\".\n3. Wire cmdAccount into the root app's Commands slice in main.go.\n\n**account_test.go**:\n- TestAccountLogout: subtest \"logout removes session file\" (create session, run logout via runWithOutput, verify file gone and output contains \"Logged out\"), subtest \"logout succeeds when no session exists\"\n- TestAccountStatus_NotLoggedIn: call status without session, expect error containing \"not logged in\"\n- TestAccountLogin_MissingCredentials: call login without flags, expect error\n\n## Test\ngo test -v -run \"TestAccount\" ./...\n\n## Don't\n- Use \"audiogoat\" anywhere in error messages or paths — always \"hb\" or \"heartbeads\"\n- Add any bd wrapper logic yet","status":"open","priority":1,"issue_type":"task","assignee":"david.gainforest.id","owner":"david@gainforest.net","created_at":"2026-02-13T12:57:49.227639+13:00","created_by":"daviddao","updated_at":"2026-02-13T12:57:49.227639+13:00","labels":["scope:small"],"dependencies":[{"issue_id":"heartbeads-cli-58a.4","depends_on_id":"heartbeads-cli-58a","type":"parent-child","created_at":"2026-02-13T12:57:49.228458+13:00","created_by":"daviddao"},{"issue_id":"heartbeads-cli-58a.4","depends_on_id":"heartbeads-cli-58a.3","type":"blocks","created_at":"2026-02-13T13:00:15.604253+13:00","created_by":"daviddao"},{"issue_id":"heartbeads-cli-58a.4","depends_on_id":"heartbeads-cli-58a.1","type":"blocks","created_at":"2026-02-13T13:00:15.690757+13:00","created_by":"daviddao"}]}
{"id":"heartbeads-cli-58a.5","title":"bd executor: find binary, run with BD_NAME=hb, rewrite output","description":"## Files\n- executor.go (create)\n- executor_test.go (create)\n\n## What to do\nCreate the core bd execution engine that all hb commands delegate to:\n\n1. **findBdBinary() (string, error)**: Use exec.LookPath(\"bd\") to find the bd binary. Return descriptive error if not found: \"bd binary not found in PATH. Install beads: https://github.com/steveyegge/beads\"\n2. **rewriteOutput(input []byte) []byte**: Replace occurrences of \"bd \" (word boundary) with \"hb \" in command output. Specifically:\n   - Replace \\`bd \\` at start of line or after backtick/quote with \\`hb \\`\n   - Replace \\` bd\\` at end of line or before backtick/quote with \\` hb\\`\n   - Replace \"bd(\" with \"hb(\" and \"bd)\" with \"hb)\"\n   - Replace standalone \"bd --\" with \"hb --\"\n   - Use regexp: \\bbd\\b → hb (but be careful not to replace \"bd-\" issue IDs like \"bd-w382l\")\n   - Safe approach: replace these exact patterns: \"Run \\`bd \" → \"Run \\`hb \", \"\\`bd \" → \"\\`hb \", \" bd \" → \" hb \" (only in prose, not in issue IDs), \"bd --\" → \"hb --\"\n   - Also replace \"bd (beads)\" with \"hb (heartbeads)\" and \"**bd**\" with \"**hb**\"\n3. **runBd(ctx context.Context, args []string, extraEnv ...string) (stdout []byte, stderr []byte, exitCode int, err error)**:\n   - Finds bd binary\n   - Sets env: BD_NAME=hb (so cobra help text uses \"hb\"), plus any extraEnv key=value pairs\n   - Inherits all other env vars from current process\n   - Runs bd with given args\n   - Captures stdout and stderr separately\n   - Applies rewriteOutput to both stdout and stderr\n   - Returns rewritten output and the exit code\n\n**executor_test.go**:\n- TestFindBdBinary: verify it finds bd (since bd is installed in the dev env)\n- TestRewriteOutput: table-driven tests:\n  - \"Run \\`bd ready\\`\" → \"Run \\`hb ready\\`\"\n  - \"\\`bd create\\`\" → \"\\`hb create\\`\"\n  - \"bd --help\" → \"hb --help\"\n  - \"**bd (beads)**\" → \"**hb (heartbeads)**\"\n  - \"bd-w382l\" → \"bd-w382l\" (unchanged — issue IDs preserved)\n  - \"bd sync\" → \"hb sync\"\n  - Empty input → empty output\n- TestRunBd: run \"bd version\" through runBd, verify stdout contains \"hb version\" (since BD_NAME=hb), exit code 0\n\n## Test\ngo test -v -run \"TestFindBd|TestRewrite|TestRunBd\" ./...\n\n## Don't\n- Add auth checking here (that's in the middleware task)\n- Import any atproto packages\n- Handle --assignee injection (that's a separate task)","status":"open","priority":1,"issue_type":"task","assignee":"david.gainforest.id","owner":"david@gainforest.net","created_at":"2026-02-13T12:58:07.317861+13:00","created_by":"daviddao","updated_at":"2026-02-13T12:58:07.317861+13:00","labels":["scope:medium"],"dependencies":[{"issue_id":"heartbeads-cli-58a.5","depends_on_id":"heartbeads-cli-58a","type":"parent-child","created_at":"2026-02-13T12:58:07.318534+13:00","created_by":"daviddao"},{"issue_id":"heartbeads-cli-58a.5","depends_on_id":"heartbeads-cli-58a.1","type":"blocks","created_at":"2026-02-13T13:00:15.776099+13:00","created_by":"daviddao"}]}
{"id":"heartbeads-cli-58a.6","title":"Auth guard middleware: require login before bd commands","description":"## Files\n- guard.go (create)\n- guard_test.go (create)\n\n## What to do\nCreate the auth guard that checks login status before executing bd commands:\n\n1. **requireAuth() (*AuthSession, error)**: Load auth session via loadAuthSessionFile(). If ErrNoAuthSession, return formatted error: \"Not logged in. Run: hb account login --username \u003chandle\u003e --password \u003capp-password\u003e\". Otherwise return the session.\n2. **guardedBdAction(ctx context.Context, cmd *cli.Command) error**: The standard action for all bd-proxied commands:\n   - Call requireAuth() — if error, print to stderr and return error\n   - Get the bd subcommand from cmd.Name() and any remaining args\n   - Call runBd(ctx, args) with the appropriate arguments\n   - Write rewritten stdout to cmd.Root().Writer\n   - Write rewritten stderr to os.Stderr\n   - If exitCode != 0, return fmt.Errorf(\"hb %s failed with exit code %d\", cmd.Name(), exitCode)\n   - Return nil on success\n\nThis is the core middleware function. Every proxied bd command will use guardedBdAction as its Action.\n\n**guard_test.go**:\n- TestRequireAuth_NotLoggedIn: empty XDG dir, call requireAuth, check error message contains \"Not logged in\" and \"hb account login\"\n- TestRequireAuth_LoggedIn: write session file, call requireAuth, check session.Handle is correct\n- TestGuardedBdAction_NotLoggedIn: construct minimal cli.Command, call guardedBdAction with no session, verify error contains \"Not logged in\"\n\n## Test\ngo test -v -run \"TestRequireAuth|TestGuardedBd\" ./...\n\n## Don't\n- Add --assignee injection logic (that's in the next task)\n- Define any CLI command registrations (that's in the proxy commands task)\n- Shell out to bd in tests (unit test the guard logic with mocked session files only)","status":"open","priority":1,"issue_type":"task","assignee":"david.gainforest.id","owner":"david@gainforest.net","created_at":"2026-02-13T12:58:19.815947+13:00","created_by":"daviddao","updated_at":"2026-02-13T12:58:19.815947+13:00","labels":["scope:small"],"dependencies":[{"issue_id":"heartbeads-cli-58a.6","depends_on_id":"heartbeads-cli-58a","type":"parent-child","created_at":"2026-02-13T12:58:19.81672+13:00","created_by":"daviddao"},{"issue_id":"heartbeads-cli-58a.6","depends_on_id":"heartbeads-cli-58a.3","type":"blocks","created_at":"2026-02-13T13:00:15.862041+13:00","created_by":"daviddao"},{"issue_id":"heartbeads-cli-58a.6","depends_on_id":"heartbeads-cli-58a.5","type":"blocks","created_at":"2026-02-13T13:00:15.949385+13:00","created_by":"daviddao"}]}
{"id":"heartbeads-cli-58a.7","title":"Assignee auto-injection for create, update, close commands","description":"## Files\n- assignee.go (create)\n- assignee_test.go (create)\n\n## What to do\nCreate the assignee auto-injection logic that ensures the logged-in ATProto handle is always set as assignee on ownership-relevant bd commands:\n\n1. **assigneeCommands**: Package-level var — a set of bd command names where --assignee should be auto-injected: {\"create\", \"update\", \"close\", \"q\"}. These are commands that change issue ownership.\n2. **injectAssignee(args []string, handle string) []string**: Takes the raw bd args and the logged-in handle. Logic:\n   - Check if args[0] (the bd subcommand) is in assigneeCommands\n   - If not in set, return args unchanged\n   - Check if --assignee or -a is already present in args — if so, return args unchanged (user explicitly overrode)\n   - Append \"--assignee\", handle to the args\n   - Return modified args\n3. **buildBdArgs(cmd *cli.Command, sess *AuthSession) []string**: Higher-level function:\n   - Reconstruct the bd command line from the cli.Command tree (walk up from cmd to get subcommand path, e.g. [\"create\"], plus all remaining arguments from cmd.Args())\n   - Also collect all flags that were set on cmd and pass them through\n   - Call injectAssignee with the handle from sess\n   - Return the final args slice\n\n**assignee_test.go**: Table-driven tests for injectAssignee:\n- (\"create\", \"Fix bug\", \"--priority\", \"1\") + \"alice.bsky.social\" → includes \"--assignee\", \"alice.bsky.social\"\n- (\"create\", \"Fix bug\", \"--assignee\", \"bob.bsky.social\") + \"alice.bsky.social\" → unchanged (explicit override preserved)\n- (\"create\", \"Fix bug\", \"-a\", \"bob.bsky.social\") + \"alice.bsky.social\" → unchanged (short flag override preserved)\n- (\"list\",) + \"alice.bsky.social\" → unchanged (list not in assigneeCommands)\n- (\"close\", \"bd-123\") + \"alice.bsky.social\" → includes \"--assignee\", \"alice.bsky.social\"\n- (\"update\", \"bd-123\", \"--status\", \"in_progress\") + \"alice.bsky.social\" → includes \"--assignee\"\n- (\"q\", \"Quick task\") + \"alice.bsky.social\" → includes \"--assignee\"\n\n## Test\ngo test -v -run \"TestInjectAssignee\" ./...\n\n## Don't\n- Modify guard.go yet (integration comes in a later task)\n- Import atproto packages\n- Test with real bd binary (unit tests only)","status":"open","priority":1,"issue_type":"task","assignee":"david.gainforest.id","owner":"david@gainforest.net","created_at":"2026-02-13T12:58:35.603588+13:00","created_by":"daviddao","updated_at":"2026-02-13T12:58:35.603588+13:00","labels":["scope:small"],"dependencies":[{"issue_id":"heartbeads-cli-58a.7","depends_on_id":"heartbeads-cli-58a","type":"parent-child","created_at":"2026-02-13T12:58:35.604284+13:00","created_by":"daviddao"},{"issue_id":"heartbeads-cli-58a.7","depends_on_id":"heartbeads-cli-58a.2","type":"blocks","created_at":"2026-02-13T13:00:16.035384+13:00","created_by":"daviddao"}]}
{"id":"heartbeads-cli-58a.8","title":"Proxy command registration: wire all bd commands through hb","description":"## Files\n- proxy.go (create)\n- proxy_test.go (create)\n- main.go (modify — add proxy commands to root)\n\n## What to do\nRegister all bd commands as hb subcommands that proxy through the auth guard. The key insight: hb doesn't need to know every bd subcommand. It uses a catch-all approach.\n\n1. **proxyAction(ctx context.Context, cmd *cli.Command) error**: The unified action for all proxied commands:\n   - Call requireAuth() to get session\n   - Build args: start with cmd.Name(), append cmd.Args().Slice()\n   - Call injectAssignee(args, sess.Handle)\n   - Call runBd(ctx, args)\n   - Write stdout/stderr, handle exit code (same as guardedBdAction from task .6, but now with assignee injection)\n\n2. **buildProxyCommands() []*cli.Command**: Create cli.Command entries for the most common bd commands:\n   - Core workflow: init, list, ready, show, create, update, close, search, blocked\n   - Dependencies: dep\n   - Sync: sync, export, import\n   - Setup: onboard, prime, quickstart, setup, config, info, status, hooks, doctor\n   - Structure: epic, children, graph, comments, label\n   - Other: delete, reopen, count, stale, q, rename, todo\n   \n   Each command: Name=\u003cbd-cmd-name\u003e, Usage=\"(proxied to bd)\", Action=proxyAction, SkipFlagParsing=true (let bd handle all flag parsing)\n\n3. **Catch-all**: The root command's Action should also check: if args[1] doesn't match any known subcommand AND doesn't match \"account\", proxy it to bd anyway. This handles any bd commands we didn't explicitly list. Use cmd.Root().Action as a fallback that runs proxyAction.\n\n   Actually, simpler approach: set cli.Command's DefaultCommand or use the root command's Action to handle unknown subcommands by proxying them to bd.\n\n4. Wire buildProxyCommands() into main.go's buildApp Commands list (alongside cmdAccount from task .4).\n\n**proxy_test.go**:\n- TestBuildProxyCommands: verify the returned slice contains \"init\", \"list\", \"ready\", \"create\", \"close\" commands\n- TestProxyAction_NotLoggedIn: create a proxy command, invoke without session, verify error contains \"Not logged in\"\n\n## Test\ngo test -v -run \"TestBuildProxy|TestProxyAction\" ./...\n\n## Don't\n- Parse bd's flags in hb (use SkipFlagParsing=true)\n- Add special handling per command (all commands go through same proxyAction)\n- Duplicate any bd business logic","status":"open","priority":1,"issue_type":"task","assignee":"david.gainforest.id","owner":"david@gainforest.net","created_at":"2026-02-13T12:58:55.179534+13:00","created_by":"daviddao","updated_at":"2026-02-13T12:58:55.179534+13:00","labels":["scope:medium"],"dependencies":[{"issue_id":"heartbeads-cli-58a.8","depends_on_id":"heartbeads-cli-58a","type":"parent-child","created_at":"2026-02-13T12:58:55.180328+13:00","created_by":"daviddao"},{"issue_id":"heartbeads-cli-58a.8","depends_on_id":"heartbeads-cli-58a.6","type":"blocks","created_at":"2026-02-13T13:00:16.126038+13:00","created_by":"daviddao"},{"issue_id":"heartbeads-cli-58a.8","depends_on_id":"heartbeads-cli-58a.7","type":"blocks","created_at":"2026-02-13T13:00:16.215499+13:00","created_by":"daviddao"},{"issue_id":"heartbeads-cli-58a.8","depends_on_id":"heartbeads-cli-58a.4","type":"blocks","created_at":"2026-02-13T13:00:16.30101+13:00","created_by":"daviddao"}]}
{"id":"heartbeads-cli-58a.9","title":"Integration test: end-to-end hb login → hb list → hb create flow","description":"## Files\n- integration_test.go (create)\n\n## What to do\nCreate integration tests that verify the full hb workflow using the real bd binary (but mocked auth):\n\n1. **TestHbWithoutLogin**: Run hb list (via runWithOutput) with empty XDG state. Verify:\n   - Exit code != 0\n   - Stderr contains \"Not logged in\"\n   - Stderr contains \"hb account login\" (not \"bd\")\n\n2. **TestHbHelp**: Run hb --help. Verify:\n   - Exit code 0\n   - Output contains \"hb\" (not \"bd\" in help text)\n   - Output contains \"account\" subcommand\n   - Output does NOT require login (help is always accessible)\n\n3. **TestHbAccountLogout**: Run hb account logout with empty XDG state. Verify exit 0 (logout always succeeds).\n\n4. **TestHbVersionNoAuth**: Run hb --version. Verify:\n   - Exit code 0\n   - Does NOT require login (version is always accessible)\n   - Output contains \"hb version\"\n\n5. **TestOutputRewriting**: Run hb onboard with a mocked auth session file (write a fake session to XDG). Verify:\n   - Output contains \"hb\" where bd's output would say \"bd\"\n   - Output does NOT contain \"`bd \" (backtick-bd-space) — all should be rewritten to \"`hb \"\n\nNote: Tests that call the real bd binary should use build tag \"integration\" and t.Skip if bd is not in PATH. Use setupTestXDG to isolate auth state.\n\n## Test\ngo test -v -tags integration -run \"TestHb\" ./...\n\n## Don't\n- Test with real ATProto login (no network calls)\n- Modify any other files\n- Skip the build tag — these tests need bd installed","status":"open","priority":2,"issue_type":"task","assignee":"david.gainforest.id","owner":"david@gainforest.net","created_at":"2026-02-13T12:59:08.942612+13:00","created_by":"daviddao","updated_at":"2026-02-13T12:59:08.942612+13:00","labels":["scope:medium"],"dependencies":[{"issue_id":"heartbeads-cli-58a.9","depends_on_id":"heartbeads-cli-58a","type":"parent-child","created_at":"2026-02-13T12:59:08.943359+13:00","created_by":"daviddao"},{"issue_id":"heartbeads-cli-58a.9","depends_on_id":"heartbeads-cli-58a.8","type":"blocks","created_at":"2026-02-13T13:00:16.38659+13:00","created_by":"daviddao"}]}
